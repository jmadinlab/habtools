---
title: "Metrics of fractal dimension"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Metrics of fractal dimension}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(habtools)
library(raster)
```

This vignette highlights issues that may arise when using `habtools` for estimating fractal dimension by applying three methods (cube counting, height variation and area method) to a series of simulated and natural surfaces. Each of these methods should be used cautiously on natural surfaces, because each has their own biases. For example, some methods are sensitive to particular elements, like outliers or drop-offs, while others are invariant to them. Because most natural surfaces are not self-similar, then these considerations matter and require decisions based on the question being addressed. 

### Fractal terrain (diamond-sqaure algorithm)

Low smoothness

```{r fig.width=7, fig.height=7, echo=FALSE}
par(mfrow=c(2, 2))

smoothness <- 0
z_extent <- FALSE
lvec <- c(4, 8, 16, 32, 64)
surf1 <- sim_terrain(64, smoothness, z_extent)
plot(surf1, asp=1, main=paste0("smoothness = ", smoothness, "\n", "z_extent = FALSE"))

fd_diagnose(surf1, lvec, "hvar")
fd_diagnose(surf1, lvec, "area")
fd_diagnose(surf1, lvec, "cubes")

par(mfrow=c(2, 2))

z_extent <- TRUE
surf2 <- sim_terrain(64, smoothness, z_extent)
plot(surf2)

fd_diagnose(surf2, lvec, "hvar")
fd_diagnose(surf2, lvec, "area")
fd_diagnose(surf2, lvec, "cubes")

```

High smoothness

```{r fig.width=7, fig.height=7, echo=FALSE}
par(mfrow=c(2, 2))

smoothness <- 1
z_extent <- FALSE
surf1 <- sim_terrain(64, smoothness, z_extent)
lvec <- c(4, 8, 16, 32, 64)
plot(surf1, asp=1, main=paste0("smoothness = ", smoothness, "\n", "z_extent = FALSE"))

fd_diagnose(surf1, lvec, "hvar")
fd_diagnose(surf1, lvec, "area")
fd_diagnose(surf1, lvec, "cubes")

par(mfrow=c(2, 2))

z_extent <- TRUE
surf2 <- sim_terrain(64, smoothness, z_extent)
plot(surf2)

fd_diagnose(surf2, lvec, "hvar")
fd_diagnose(surf2, lvec, "area")
fd_diagnose(surf2, lvec, "cubes")

```

Real reef

```{r fig.width=7, fig.height=7, echo=FALSE}
par(mfrow=c(2, 2))

surf1 <- crop(horseshoe, raster::extent(horseshoe, 1, 128, 1, 128))
res <- raster::res(surf1)
values(surf1) <- values(surf1) - min(values(surf1))
lvec <- c(4, 8, 16, 32, 64, 128) * res
plot(surf1, asp=1, main=paste0("horseshoe\n", "z_extent = FALSE"))

fd_diagnose(surf1, lvec, "hvar")
fd_diagnose(surf1, lvec, "area")
fd_diagnose(surf1, lvec, "cubes")

par(mfrow=c(2, 2))

surf2 <- surf1
values(surf2) <- values(surf1) * (res*128) / max(values(surf1))
range(values(surf2))

plot(surf2, main=paste0("horseshoe\n", "z_extent = TRUE"))

fd_diagnose(surf2, lvec, "hvar")
fd_diagnose(surf2, lvec, "area")
fd_diagnose(surf2, lvec, "cubes")

```




